<!doctype html>
 
<html lang="en">
    <head>
        <meta charset="utf-8">
 
        <title>Voxels</title>
    </head>
 
    <body>
        <canvas id="myCanvas"></canvas>
          <script>
            sleepFor(1000);
            var points = [];
            var size = 10;
            var backPlane = 100;
            for(var z = 0;z<10;z++){
                for(var x = 10-z;x<10;x++){
                    for(var y = 10-z;y<10;y++){
                        points.push({x:x,y:y,z:z,color: '#' + (z*25).toString(16) + (x*25).toString(16) + (y*25).toString(16)});
                    }
                }
            }
            var c=document.getElementById("myCanvas");
            var ctx=c.getContext("2d");
 
            setInterval(update,20);
            update();
 
            function render(){
                ctx.clearRect(0, 0, c.width, c.height);
                for(var i = 0; i< points.length; i++){
                    var point = points[i];
                    var x = point.x + 20;
                    var y = point.y + 20;
                    var z = point.z;
                    if(y<0.1||y>backPlane){
                        continue;
                    }
                    //console.log(x + '  ' + y + ' ' + z);
                    ctx.fillStyle = point.color;
                    var dist = (backPlane-y)/backPlane;
                    var thisSize = size/dist;
                    ctx.fillRect((x*size)-thisSize,(z*size)-thisSize,2*thisSize,2*thisSize);
                }
            }
 
            function update(){
                for(var i =0;i < points.length; i++){
                    rotateZ(points[i],0.1);
                }
                render();
            }
 
            function rotateZ(point,angle){
                var x = point.x;
                var y = point.y;
                var z = point.z;
                point.x = Math.cos(angle)*x - Math.sin(angle)*y;
                point.y = Math.sin(angle)*x + Math.cos(angle)*y;
                point.z = z;
            }
 
            function sleepFor( sleepDuration ){
                var now = new Date().getTime();
                while(new Date().getTime() < now + sleepDuration){ /* do nothing */ }
            }
          </script>
    </body>
</html>
